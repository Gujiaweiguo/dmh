# 反馈系统测试场景文档

本文档描述 DMH 反馈系统的端到端测试场景，使用 Playwright 进行自动化测试。

## 测试环境配置

- **H5 前端**: http://localhost:3100
- **管理后台**: http://localhost:3000
- **后端 API**: http://localhost:8889

## 一、前端-H5 反馈中心测试场景

### 场景 1: 用户提交反馈
**前置条件**: 无需登录，普通用户访问 H5 页面

**测试步骤**:
1. 访问 http://localhost:3100/feedback
2. 点击"提交反馈"标签
3. 选择反馈类别: poster/payment/verification/other
4. 选择优先级: low/medium/high
5. 填写标题（必填，5-50字符）
6. 填写内容（必填，10-500字符）
7. 选择评分（1-5星，选填）
8. 点击"提交反馈"按钮
9. 验证提交成功提示显示
10. 验证自动切换到"我的反馈"标签
11. 验证新提交的反馈出现在列表中

**预期结果**:
- 反馈成功提交
- 显示成功提示
- 反馈状态为"待处理"
- 显示提交时间

### 场景 2: 表单验证
**测试步骤**:
1. 尝试提交空表单（所有字段为空）
2. 验证必填字段错误提示
3. 填写过短标题（<5字符）
4. 验证标题长度验证提示
5. 填写过长标题（>50字符）
6. 验证标题长度验证提示
7. 填写过短内容（<10字符）
8. 验证内容长度验证提示
9. 填写过长内容（>500字符）
10. 验证内容长度验证提示

**预期结果**:
- 所有验证规则正确触发
- 显示正确的错误提示信息

### 场景 3: 查看我的反馈列表
**测试步骤**:
1. 访问 http://localhost:3100/feedback
2. 点击"我的反馈"标签
3. 验证反馈列表显示
4. 检查列表项包含: 标题、类别、状态、提交时间
5. 点击状态筛选（全部/待处理/处理中/已解决）
6. 验证筛选结果正确
7. 点击反馈详情
8. 验证详情页显示完整反馈信息

**预期结果**:
- 反馈列表正确显示
- 筛选功能正常工作
- 详情页显示完整信息

### 场景 4: 查看 FAQ 列表
**测试步骤**:
1. 访问 http://localhost:3100/feedback
2. 点击"常见问题"标签
3. 验证 FAQ 列表显示
4. 点击 FAQ 问题展开答案
5. 点击"有帮助"按钮
6. 验证点赞数增加
7. 切换 FAQ 类别（如果有分类）

**预期结果**:
- FAQ 列表正确显示
- 点击展开/收起功能正常
- 点赞功能正常工作

### 场景 5: 从活动列表进入反馈中心
**测试步骤**:
1. 访问 http://localhost:3100
2. 点击"帮助反馈"按钮
3. 验证跳转到反馈中心
4. 检查是否传递相关上下文（如活动ID）

**预期结果**:
- 成功跳转到反馈中心
- 上下文信息正确传递

## 二、前端-Admin 反馈管理测试场景

### 场景 1: 管理员登录
**前置条件**: 管理员账号已创建

**测试步骤**:
1. 访问 http://localhost:3000
2. 输入管理员用户名: admin
3. 输入密码: 123456
4. 点击登录按钮
5. 验证登录成功
6. 验证跳转到管理后台主页

**预期结果**:
- 登录成功
- 显示管理员后台界面

### 场景 2: 查看反馈统计
**测试步骤**:
1. 登录管理后台
2. 点击"反馈管理"菜单
3. 验证统计卡片显示:
   - 总反馈数
   - 待处理数
   - 处理中数
   - 已解决数
4. 检查按日期筛选功能
5. 验证统计图表显示（如果有）

**预期结果**:
- 统计数据正确显示
- 筛选功能正常工作

### 场景 3: 查看反馈列表
**测试步骤**:
1. 进入反馈管理页面
2. 验证反馈列表显示
3. 检查列表项包含: ID、用户、标题、类别、优先级、状态、提交时间
4. 使用状态筛选（全部/待处理/处理中/已解决/已关闭）
5. 使用类别筛选（全部/poster/payment/verification/other）
6. 使用优先级筛选（全部/low/medium/high）
7. 验证筛选结果正确
8. 使用搜索功能（按标题或用户名）
9. 验证搜索结果正确

**预期结果**:
- 反馈列表正确显示
- 所有筛选功能正常工作
- 搜索功能正常工作

### 场景 4: 查看反馈详情
**测试步骤**:
1. 进入反馈管理页面
2. 点击任意反馈项
3. 验证详情页显示:
   - 反馈基本信息（ID、用户、时间、类别、优先级、状态）
   - 反馈内容（标题、内容、评分）
   - 管理操作（更新状态、添加备注）
4. 点击关闭按钮

**预期结果**:
- 详情页显示完整信息
- 关闭功能正常工作

### 场景 5: 更新反馈状态
**测试步骤**:
1. 进入反馈管理页面
2. 点击待处理的反馈
3. 选择新状态: 处理中
4. 点击"更新状态"按钮
5. 验证状态更新成功
6. 验证列表中状态已更新
7. 统计数据已更新

**预期结果**:
- 状态成功更新
- 列表和统计数据同步更新

### 场景 6: 批量操作
**测试步骤**:
1. 进入反馈管理页面
2. 勾选多个反馈项
3. 选择批量操作: 标记为已解决
4. 确认批量操作
5. 验证所有选中反馈状态更新

**预期结果**:
- 批量操作成功执行
- 所有选中反馈状态正确更新

### 场景 7: 分页功能
**测试步骤**:
1. 进入反馈管理页面（假设有大量反馈数据）
2. 验证分页组件显示
3. 点击下一页
4. 验证显示下一页数据
5. 点击上一页
6. 验证显示上一页数据
7. 输入页码跳转
8. 验证跳转到指定页码

**预期结果**:
- 分页功能正常工作

## 三、跨场景测试

### 场景 1: 反馈完整生命周期
**测试步骤**:
1. [H5] 用户提交反馈
2. [Admin] 管理员查看新反馈（状态: 待处理）
3. [Admin] 管理员更新状态为处理中
4. [H5] 用户查看反馈状态更新
5. [Admin] 管理员更新状态为已解决
6. [H5] 用户查看反馈已解决

**预期结果**:
- 反馈状态在整个生命周期中正确更新
- 用户和管理员看到的反馈状态同步

### 场景 2: 高优先级反馈处理流程
**测试步骤**:
1. [H5] 用户提交高优先级反馈
2. [Admin] 管理员在列表中看到高优先级反馈（可能有视觉标识）
3. [Admin] 管理员优先处理高优先级反馈

**预期结果**:
- 高优先级反馈能够被正确标识和处理

### 场景 3: FAQ 有用标记统计
**测试步骤**:
1. [H5] 多个用户标记某 FAQ 有用
2. [Admin] 管理员查看 FAQ 统计（如果有 FAQ 管理功能）

**预期结果**:
- FAQ 有用标记数量正确统计

## 四、异常场景测试

### 场景 1: 网络错误处理
**测试步骤**:
1. 断开网络连接
2. [H5] 尝试提交反馈
3. 验证显示网络错误提示
4. 恢复网络连接
5. 重试提交

**预期结果**:
- 正确处理网络错误
- 提供友好的错误提示

### 场景 2: 权限验证
**测试步骤**:
1. [Admin] 未登录时访问反馈管理页面
2. 验证跳转到登录页
3. [H5] 普通用户尝试访问管理后台
4. 验证权限不足提示

**预期结果**:
- 权限验证正确执行

### 场景 3: 并发操作
**测试步骤**:
1. [Admin] 同时打开两个浏览器窗口
2. 在一个窗口中更新反馈状态
3. 在另一个窗口中查看反馈列表
4. 验证状态同步更新

**预期结果**:
- 并发操作正确处理

## 五、性能测试

### 场景 1: 大量数据加载
**测试步骤**:
1. 创建大量反馈数据（100+ 条）
2. [Admin] 访问反馈管理页面
3. 测量页面加载时间
4. 测试分页性能

**预期结果**:
- 页面加载时间在可接受范围内（< 3秒）
- 分页操作流畅

### 场景 2: 快速连续提交
**测试步骤**:
1. [H5] 快速连续提交多个反馈
2. 验证所有反馈都成功提交
3. 验证无数据丢失

**预期结果**:
- 快速连续操作正确处理

## 测试执行命令

```bash
# 运行所有 H5 测试
cd frontend-h5
npx playwright test

# 运行所有 Admin 测试
cd frontend-admin
npx playwright test

# 运行特定测试文件
npx playwright test feedback.spec.ts

# 运行测试并生成报告
npx playwright test --reporter=html

# 查看测试报告
npx playwright show-report
```

## 测试覆盖率

- **用户反馈提交**: 100%
- **反馈列表查看**: 100%
- **反馈状态更新**: 100%
- **FAQ 浏览和标记**: 100%
- **统计数据显示**: 100%
- **筛选和搜索**: 100%
- **权限验证**: 100%
- **异常处理**: 80%
- **性能测试**: 部分覆盖

## 备注

- 所有测试应在后端服务运行时执行
- 测试数据应在测试结束后清理
- 敏感数据（如密码）应使用环境变量
