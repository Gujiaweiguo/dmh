# 🚀 DMH 数字营销中台 - 系统启动完成（已修正）

## 📌 系统访问地址

| 服务 | 地址 | 状态 | 适用角色 |
|------|------|------|----------|
| **管理后台** | http://localhost:3001 | ✅ 运行中 | 平台管理员（PC） |
| **H5 品牌管理端** | http://localhost:3101/brand.html | ✅ 运行中 | 品牌管理员（移动） |
| **H5 活动中心** | http://localhost:3101/ | ✅ 运行中 | 普通用户、分销商（移动） |
| **H5 用户中心** | http://localhost:3101/user.html | ✅ 运行中 | 普通用户、分销商（移动） |
| **后端 API** | http://localhost:8889 | ✅ 运行中 | - |

---

## 🔐 测试账号信息

### 👤 平台管理员
| 项目 | 内容 |
|------|------|
| **访问地址** | http://localhost:3001 |
| **界面类型** | 管理后台（PC） |
| **用户名** | `admin` |
| **密码** | `123456` |
| **姓名** | 系统管理员 |
| **手机号** | 13800000001 |
| **角色** | 平台管理员 (platform_admin) |
| **状态** | ✅ active |

**主要功能：**
- 📊 查看全局统计数据
- 👥 管理所有用户
- 🏢 管理所有品牌
- 📦 查看所有活动
- 💰 **分销管理：**
  - 全局分销商查询（查看所有品牌的分销商）
  - 全局奖励查询（查看所有品牌的奖励明细）
  - 全局提现查询（查看所有品牌的提现记录）
  - 提现审批（审批分销商的提现申请）
- ⚙️ 系统管理

---

### 👤 品牌管理员
| 项目 | 内容 |
|------|------|
| **访问地址** | http://localhost:3101/brand.html |
| **界面类型** | H5 端（移动端品牌管理） |
| **用户名** | `brand_manager` |
| **密码** | `123456` |
| **姓名** | 品牌经理 |
| **手机号** | 13800000002 |
| **角色** | 品牌管理员 (brand_admin) |
| **管理品牌** | 品牌A (ID: 1) |
| **状态** | ✅ active |

**主要功能：**
- 📊 查看品牌数据统计
- 🏢 管理品牌信息
- 📦 **活动管理：**
  - 创建/编辑活动
  - 配置分销规则
  - 启用/禁用分销功能
  - 设置分销层级（1-3级）
  - 设置各级奖励比例（如：一级10%、二级5%、三级3%）
- 📦 订单管理
- 👥 会员管理
- 🧠 素材管理
- 💰 **分销管理：**
  - 分销商管理（查看和管理本品牌分销商）
  - 分销商审批
  - 调整分销商级别
  - 暂停/激活分销商
  - 奖励设置
  - 查看奖励详情
  - 推广员管理

**说明：** 品牌管理员使用 H5 品牌管理端（移动端），方便移动办公和在外地管理品牌。

---

### 💎 一级分销商 - 张三
| 项目 | 内容 |
|------|------|
| **活动中心** | http://localhost:3101/ |
| **用户中心** | http://localhost:3101/user.html |
| **界面类型** | H5 端（移动端） |
| **用户名** | `distributor1` |
| **密码** | `123456` |
| **姓名** | 张三 |
| **手机号** | 13900000001 |
| **品牌** | 品牌A |
| **级别** | 一级 (Level 1) |
| **余额** | ¥500.00 |
| **累计收益** | ¥90.00 |
| **下级数量** | 2人 |
| **状态** | ✅ active |

**主要功能：**
- 📦 活动中心：查看活动、参与活动
- 🧑 个人中心：查看个人信息
- 💎 **分销中心：**
  - 查看推广数据统计
  - 查看奖励明细
  - 查看下级列表
  - 申请提现
  - 查看提现记录
- 🎯 **推广页面：**
  - 生成活动专属海报
  - 生成通用分销商海报
  - 获取推广链接和二维码
  - 查看推广数据

---

### 💎 二级分销商 - 李四
| 项目 | 内容 |
|------|------|
| **活动中心** | http://localhost:3101/ |
| **用户中心** | http://localhost:3101/user.html |
| **界面类型** | H5 端（移动端） |
| **用户名** | `distributor2` |
| **密码** | `123456` |
| **姓名** | 李四 |
| **手机号** | 13900000002 |
| **品牌** | 品牌A |
| **级别** | 二级 (Level 2) |
| **上级** | 张三（一级分销商） |
| **余额** | ¥200.00 |
| **累计收益** | ¥35.00 |
| **下级数量** | 1人 |
| **状态** | ✅ active |

**主要功能：** 同一级分销商

---

### 💎 三级分销商 - 王五
| 项目 | 内容 |
|------|------|
| **活动中心** | http://localhost:3101/ |
| **用户中心** | http://localhost:3101/user.html |
| **界面类型** | H5 端（移动端） |
| **用户名** | `distributor3` |
| **密码** | `123456` |
| **姓名** | 王五 |
| **手机号** | 13900000003 |
| **品牌** | 品牌A |
| **级别** | 三级 (Level 3) |
| **上级** | 李四（二级分销商） |
| **余额** | ¥100.00 |
| **累计收益** | ¥12.00 |
| **下级数量** | 0人 |
| **状态** | ✅ active |

**主要功能：** 同一级分销商

---

### 👤 普通用户 - 赵六
| 项目 | 内容 |
|------|------|
| **活动中心** | http://localhost:3101/ |
| **用户中心** | http://localhost:3101/user.html |
| **界面类型** | H5 端（移动端） |
| **用户名** | `participant1` |
| **密码** | `123456` |
| **姓名** | 赵六 |
| **手机号** | 13900000004 |
| **角色** | 参与者（普通用户） |
| **品牌** | 品牌A |
| **余额** | ¥0.00 |
| **状态** | ✅ active |

**主要功能：**
- 📦 活动中心：查看活动、参与活动、下单支付
- 🧑 个人中心：查看个人信息
- 💰 支付后自动成为分销商
- 💎 成为分销商后可使用分销功能

---

### 👤 普通用户 - 钱七
| 项目 | 内容 |
|------|------|
| **活动中心** | http://localhost:3101/ |
| **用户中心** | http://localhost:3101/user.html |
| **界面类型** | H5 端（移动端） |
| **用户名** | `participant2` |
| **密码** | `123456` |
| **姓名** | 钱七 |
| **手机号** | 13900000005 |
| **角色** | 参与者（普通用户） |
| **品牌** | 品牌A |
| **余额** | ¥0.00 |
| **状态** | ✅ active |

---

## 🌳 分销链结构

```
张三 (distributor1 - 一级分销商)
  ├── 李四 (distributor2 - 二级分销商)
  │    └── 王五 (distributor3 - 三级分销商)
  └── 待添加...
```

**分销关系说明：**
- **张三**（distributor1）是一级分销商，有2个下级（李四）
- **李四**（distributor2）是二级分销商，上级是张三，有1个下级（王五）
- **王五**（distributor3）是三级分销商，上级是李四，暂无下级

**多级分销奖励分配：**
当用户通过王五的推广链接下单时，奖励分配如下：
- 张三（一级）获得：订单金额 × 10%
- 李四（二级）获得：订单金额 × 5%
- 王五（三级）获得：订单金额 × 3%

---

## 📋 测试数据概览

### 分销商数据汇总

| 分销商 | 姓名 | 级别 | 余额 | 累计收益 | 下级数 | 状态 |
|--------|------|------|------|----------|--------|------|
| distributor1 | 张三 | 一级 | ¥500.00 | ¥90.00 | 2 | active |
| distributor2 | 李四 | 二级 | ¥200.00 | ¥35.00 | 1 | active |
| distributor3 | 王五 | 三级 | ¥100.00 | ¥12.00 | 0 | active |

### 用户余额数据

| 用户名 | 姓名 | 角色 | 余额 |
|--------|------|------|------|
| distributor1 | 张三 | 分销商 | ¥500.00 |
| distributor2 | 李四 | 分销商 | ¥200.00 |
| distributor3 | 王五 | 分销商 | ¥100.00 |
| participant1 | 赵六 | 参与者 | ¥0.00 |
| participant2 | 钱七 | 参与者 | ¥0.00 |

### 品牌数据

| 品牌ID | 品牌名称 | 状态 |
|--------|----------|------|
| 1 | 星巴克咖啡 | active |
| 2 | 麦当劳 | active |

### 活动数据

| 活动ID | 活动名称 | 状态 | 分销配置 |
|--------|----------|------|----------|
| 1 | 新年促销活动 | active | 已启用，3级，10%/5%/3% |
| 2 | 春季招生活动 | active | 已启用，3级，10%/5%/3% |

---

## 🎯 测试场景建议

### 1️⃣ 测试自动升级为分销商
**步骤：**
1. 使用 `participant1`（赵六）登录活动中心：http://localhost:3101/
2. 参与活动并下单支付
3. 支付成功后，用户自动成为分销商
4. 重新登录用户中心：http://localhost:3101/user.html，查看是否出现"分销中心"入口

**预期结果：**
- 用户支付后自动创建分销商记录
- 获得distributor角色
- 可以访问分销中心功能

---

### 2️⃣ 测试分销推广流程
**步骤：**
1. 使用 `distributor1`（张三）登录用户中心：http://localhost:3101/user.html
2. 进入"推广"页面
3. 选择活动并生成海报或推广链接
4. 分享海报/链接给其他用户
5. 其他用户通过链接下单

**预期结果：**
- 可以生成活动专属海报
- 可以获取推广链接和二维码
- 用户通过推广链接下单时自动记录分销关系

---

### 3️⃣ 测试多级奖励分配
**步骤：**
1. 使用 `distributor3`（王五）的推广链接下单
2. 订单金额：¥200
3. 查看奖励分配情况

**预期奖励分配：**
- 张三（一级）：¥200 × 10% = ¥20.00
- 李四（二级）：¥200 × 5% = ¥10.00
- 王五（三级）：¥200 × 3% = ¥6.00

**验证方式：**
1. 在H5端查看各分销商的余额变化
2. 在H5品牌管理端查看奖励明细
3. 检查数据库distributor_rewards表

---

### 4️⃣ 测试提现申请流程
**步骤：**
1. 使用 `distributor1`（张三）登录用户中心：http://localhost:3101/user.html
2. 进入"提现"页面
3. 输入提现金额、选择提现方式（微信/支付宝/银行卡）
4. 填写账号信息和真实姓名
5. 提交提现申请
6. 查看提现记录

**预期结果：**
- 可以创建提现申请
- 余额相应扣除
- 提现记录显示在"待审核"状态

---

### 5️⃣ 测试提现审批流程（平台管理员）
**步骤：**
1. 使用 `admin` 登录管理后台：http://localhost:3001
2. 进入"提现审批"页面
3. 查看待审批提现列表
4. 选择提现申请：
   - **通过**：填写审批备注
   - **拒绝**：填写拒绝原因
5. 提交审批

**预期结果：**
- 审批通过后提现状态变为"已完成"
- 审批拒绝后余额退回用户账户

---

### 6️⃣ 测试品牌管理员管理分销商（H5端）
**步骤：**
1. 使用 `brand_manager` 登录H5品牌管理端：http://localhost:3101/brand.html
2. 进入"分销管理"页面
3. 查看本品牌（品牌A）分销商列表
4. 调整分销商级别
5. 暂停/激活分销商
6. 查看"奖励设置"
7. 查看会员列表

**预期结果：**
- 只能看到本品牌的分销商、会员、奖励
- 可以调整分销商级别和状态
- 数据隔离正确

---

### 7️⃣ 测试品牌管理员配置分销规则（H5端）
**步骤：**
1. 使用 `brand_manager` 登录H5品牌管理端：http://localhost:3101/brand.html
2. 进入"活动管理" → 创建/编辑活动
3. 找到"分销规则"配置区域
4. 配置：
   - 启用/禁用分销
   - 设置分销层级（1-3级）
   - 设置各级奖励比例
5. 保存活动

**预期结果：**
- 分销规则保存成功
- 新订单按新规则分配奖励

---

### 8️⃣ 测试平台管理员查看全局数据
**步骤：**
1. 使用 `admin` 登录管理后台：http://localhost:3001
2. 进入"全局分销商"页面
3. 按品牌筛选查看分销商
4. 进入"全局奖励"页面
5. 按品牌筛选查看奖励明细
6. 进入"全局提现"页面
7. 按品牌筛选查看提现记录

**预期结果：**
- 可以查看所有品牌的数据
- 可以按品牌筛选
- 比品牌管理员有更高的权限

---

## 🗃️ 数据库信息

### 连接信息
```bash
# 通过 Docker 容器连接
docker exec -it mysql8 mysql -uroot -p'#Admin168' --default-character-set=utf8mb4 dmh
```

### 数据库配置
- **容器名：** mysql8
- **用户名：** root
- **密码：** #Admin168
- **数据库：** dmh
- **字符集：** utf8mb4

### 常用查询
```sql
-- 查看所有用户
SELECT u.id, u.username, u.real_name, u.phone, u.role, u.status 
FROM users u 
WHERE u.id IN (1,2,4,5,6,7,8)
ORDER BY u.id;

-- 查看所有分销商
SELECT d.id, u.username, u.real_name, d.level, d.status, d.total_earnings, d.subordinates_count
FROM distributors d
LEFT JOIN users u ON d.user_id = u.id;

-- 查看用户余额
SELECT u.username, u.real_name, ub.balance, ub.total_reward
FROM users u
LEFT JOIN user_balances ub ON u.id = ub.user_id
WHERE u.id IN (4,5,6,7,8);

-- 查看所有订单
SELECT o.id, c.name as campaign_name, o.amount, o.status, o.pay_status, o.distributor_path
FROM orders o
LEFT JOIN campaigns c ON o.campaign_id = c.id
WHERE o.id >= 10
ORDER BY o.id;

-- 查看所有奖励
SELECT dr.id, u.real_name as distributor_name, o.id as order_id, dr.amount, dr.distributor_level, dr.reward_percentage, dr.status
FROM distributor_rewards dr
LEFT JOIN users u ON dr.user_id = u.id
LEFT JOIN orders o ON dr.order_id = o.id
ORDER BY dr.id;

-- 查看所有提现申请
SELECT w.id, u.real_name, w.amount, w.status, w.pay_type, w.created_at
FROM withdrawals w
LEFT JOIN users u ON w.user_id = u.id
ORDER BY w.id;
```

---

## 🔄 系统架构说明

### 界面说明

1. **管理后台**（http://localhost:3001）
   - **适用角色：** 平台管理员
   - **功能特点：** 完整的管理功能、数据统计、报表查看
   - **界面风格：** PC端界面，适合复杂操作

2. **H5 品牌管理端**（http://localhost:3101/brand.html）
   - **适用角色：** 品牌管理员
   - **功能特点：** 品牌管理、活动管理、会员管理、分销商管理、素材管理
   - **界面风格：** 移动端界面，适合移动办公和在外地管理

3. **H5 活动中心**（http://localhost:3101/）
   - **适用角色：** 普通用户（参与者）、分销商
   - **功能特点：** 活动列表、活动详情、报名参与、下单支付
   - **界面风格：** 移动端界面

4. **H5 用户中心**（http://localhost:3101/user.html）
   - **适用角色：** 普通用户（参与者）、分销商
   - **功能特点：** 个人信息、订单记录、奖励明细、分销中心、推广页面、提现管理
   - **界面风格：** 移动端界面

### 权限隔离
- **平台管理员：** 可以查看和管理所有品牌的数据
- **品牌管理员：** 只能查看和管理自己品牌的数据
- **分销商/普通用户：** 只能查看自己的数据

---

## 🛠️ 系统管理

### 查看服务状态
```bash
# 查看后端
lsof -i:8889

# 查看管理后台
lsof -i:3001

# 查看H5端
lsof -i:3101

# 查看所有服务
lsof -i:8889,3001,3101
```

### 查看日志
```bash
# 查看后端日志
tail -f /tmp/dmh-backend.log

# 查看管理后台日志
tail -f /tmp/dmh-admin.log

# 查看H5端日志
tail -f /tmp/dmh-h5.log
```

### 停止服务
```bash
# 停止后端
ps aux | grep dmh-api | grep -v grep | awk '{print $2}' | xargs kill

# 停止前端
ps aux | grep "vite" | grep -v grep | awk '{print $2}' | xargs kill
```

---

## 🎉 系统已就绪

数据编码问题已修复！✅
系统架构已修正！✅

现在可以：
1. ✅ 使用管理后台测试平台管理员功能
2. ✅ 使用H5品牌管理端测试品牌管理员功能
3. ✅ 使用H5活动中心和用户中心测试普通用户和分销商功能
4. ✅ 测试完整的分销流程

---

**祝测试顺利！** 🚀
