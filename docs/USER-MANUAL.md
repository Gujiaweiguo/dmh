# DMH 活动高级功能用户使用手册

## 目录

1. [功能概述](#1-功能概述)
2. [海报生成功能](#2-海报生成功能)
3. [支付配置功能](#3-支付配置功能)
4. [订单核销功能](#4-订单核销功能)
5. [常见问题](#5-常见问题)
6. [故障排查](#6-故障排查)

***

## 1. 功能概述

DMH 活动高级功能为营销活动提供了三大核心能力：

### 1.1 海报生成

* 为活动自动生成推广海报
* 支持多种模板样式
* 支持分销商个性化海报
* 实时生成，无需人工设计

### 1.2 支付配置

* 灵活配置订金和全款支付
* 自动生成支付二维码
* 支持微信支付
* 支付状态实时同步

### 1.3 订单核销

* 扫码核销，快速便捷
* 核销码防伪造（签名验证）
* 完整的核销记录
* 支持取消核销

***

## 2. 海报生成功能

### 2.1 功能说明

海报生成功能允许管理员和分销商为活动快速生成推广海报，无需依赖设计师。

### 2.2 使用场景

| 场景 | 说明 | 使用角色 |
|------|------|---------|
| 活动发布 | 为新活动生成宣传海报 | 品牌管理员 |
| 分销推广 | 分销商生成个性化海报 | 分销商 |
| 批量营销 | 为多个活动批量生成海报 | 品牌管理员 |

### 2.3 操作步骤

#### 管理员为活动生成海报

1. **登录管理后台**
   * 访问：`http://{domain}/admin`
   * 使用管理员账号登录

2. **进入活动管理**
   * 点击左侧菜单「活动管理」
   * 找到需要生成海报的活动

3. **生成海报**
   * 点击活动列表的「生成海报」按钮
   * 在弹窗中选择海报模板：
     * **经典模板**：简洁大方，适合正式场合
     * **简约模板**：极简风格，突出主题
     * **时尚模板**：渐变背景，年轻活力
   * 点击「确认生成」按钮
   * 等待海报生成（约 1-3 秒）

4. **保存海报**
   * 生成成功后，预览海报
   * 点击「下载海报」保存到本地
   * 或点击「复制链接」获取海报 URL

#### 分销商生成个性化海报

1. **登录分销中心**
   * 访问：`http://{domain}/distributor`
   * 使用分销商账号登录

2. **进入我的活动**
   * 点击「我的活动」菜单
   * 选择已参与的活动

3. **生成个人海报**
   * 点击「生成海报」按钮
   * 海报会自动包含分销商专属二维码
   * 下载或分享海报

### 2.4 海报模板说明

| 模板名称 | 适用场景 | 特点 |
|---------|---------|------|
| 经典模板 | 商务活动、企业宣传 | 简洁大方，信息清晰 |
| 简约模板 | 短期促销、快闪活动 | 极简风格，突出主题 |
| 时尚模板 | 青年群体、潮流活动 | 渐变背景，年轻活力 |

### 2.5 注意事项

* 海报生成频率限制：每个用户每分钟最多生成 5 张
* 海报尺寸：750×1334 像素（适合微信分享）
* 海报有效期：生成的海报永久有效，可重复使用
* 二维码包含：活动链接、分销商专属链接

***

## 3. 支付配置功能

### 3.1 功能说明

支付配置功能允许管理员灵活设置活动的支付方式，支持订金和全款两种模式。

### 3.2 支付模式

#### 订金模式

* 用户先支付订金预订名额
* 到达指定地点后支付余款
* 适合高价值活动、需要确认名额的活动

#### 全款模式

* 用户一次性支付全部金额
* 支付完成后确认参与资格
* 适合标准化活动、无需现场确认的活动

### 3.3 操作步骤

#### 3.3.1 创建活动时配置支付

1. **进入活动创建页面**
   * 点击左侧菜单「活动管理」→「创建活动」

2. **填写基本信息**
   * 活动名称、描述等

3. **配置支付信息**
   * 在「支付配置」区域选择：
     * **支付类型**：订金 / 全款
     * **订金金额**：（订金模式）输入订金金额
     * **全款金额**：输入活动总金额
     * **微信商户号**：填写您的微信支付商户号
     * **回调地址**：配置支付成功后的回调地址

4. **提交活动**
   * 点击「保存」创建活动

#### 3.3.2 修改现有活动的支付配置

1. **进入活动管理**
   * 点击「活动管理」→「活动列表」

2. **编辑活动**
   * 找到需要修改的活动
   * 点击「编辑」按钮

3. **更新支付配置**
   * 修改支付类型、金额等信息

4. **保存修改**

### 3.4 获取支付二维码

1. **进入活动详情**
   * 在活动列表中点击活动名称

2. **查看支付信息**
   * 页面底部显示「支付二维码」按钮

3. **生成二维码**
   * 点击「获取支付二维码」
   * 系统自动生成支付二维码（响应时间 < 500ms）
   * 二维码包含：活动信息、金额、时间戳、签名

4. **分享二维码**
   * 点击「下载二维码」
   * 或直接分享给用户扫码支付

### 3.5 支付流程

```
用户扫码支付
    ↓
微信确认支付
    ↓
支付成功（回调通知）
    ↓
系统更新订单状态为"已支付"
    ↓
生成核销码
    ↓
用户可参与活动
```

### 3.6 注意事项

* **支付金额验证**：订金金额必须小于全款金额
* **商户号配置**：确保微信商户号正确，否则无法支付
* **二维码刷新**：支付二维码缓存 2 小时，过期后自动刷新
* **支付安全**：所有支付请求都经过签名验证
* **回调地址**：确保回调地址可被微信服务器访问

***

## 4. 订单核销功能

### 4.1 功能说明

订单核销功能用于确认用户是否到达活动现场并参与活动，支持扫码快速核销。

### 4.2 核销码说明

核销码格式：`{订单ID}_{手机号}_{时间戳}_{签名}`

* **订单ID**：唯一标识订单
* **手机号**：用户下单时填写的手机号
* **时间戳**：二维码生成时间
* **签名**：HMAC-SHA1 签名，防伪造

### 4.3 操作步骤

#### 4.3.1 用户参与活动（生成核销码）

1. **用户下单**
   * 用户在 H5 页面填写表单
   * 提交订单并支付

2. **支付成功**
   * 系统自动生成核销码
   * 用户在「我的订单」中查看核销码

3. **到达活动现场**
   * 用户向工作人员出示核销码

#### 4.3.2 工作人员核销

**方式一：扫码核销**

1. **打开核销页面**
   * 访问：`http://{domain}/admin/verify`
   * 或使用管理后台的核销功能

2. **扫描用户核销码**
   * 使用手机扫描用户出示的二维码
   * 或手动输入核销码

3. **系统验证**
   * 系统验证订单是否已支付
   * 验证核销码签名是否正确
   * 验证订单是否已核销（防重复）

4. **确认核销**
   * 显示订单信息：用户姓名、手机号、表单数据等
   * 确认信息无误后点击「确认核销」
   * 系统更新订单状态为「已核销」

**方式二：手动输入核销码**

1. 访问核销页面
2. 点击「手动输入」
3. 输入核销码：`123_13800138000_1643775200_abc123`
4. 点击「查询」
5. 确认订单信息
6. 点击「确认核销」

#### 4.3.3 取消核销

如遇特殊情况（用户未到场、填写错误等），可取消核销：

1. 进入「核销记录」页面
2. 找到需要取消的核销记录
3. 点击「取消核销」
4. 确认取消原因
5. 提交

### 4.4 核销记录查询

1. **进入核销记录**
   * 点击「订单管理」→「核销记录」

2. **筛选记录**
   * 按订单ID筛选
   * 按时间范围筛选
   * 按核销人筛选

3. **查看详情**
   * 点击记录查看完整信息

### 4.5 权限说明

| 操作 | 允许角色 | 说明 |
|------|---------|------|
| 核销订单 | 品牌管理员、平台管理员 | 必须有品牌管理员权限 |
| 取消核销 | 品牌管理员、平台管理员 | 必须有品牌管理员权限 |
| 查询核销记录 | 品牌管理员、平台管理员 | 只能查看本品牌记录 |

### 4.6 注意事项

* **核销码防伪**：签名验证确保核销码无法伪造
* **重复核销**：已核销的订单无法再次核销
* **未支付订单**：未支付订单无法核销
* **核销记录**：所有核销操作都会记录日志
* **性能要求**：核销接口响应时间 < 500ms

***

## 5. 常见问题

### 5.1 海报生成相关

**Q1：海报生成失败怎么办？**

* 检查网络连接
* 确认后端服务正常
* 联系技术支持

**Q2：海报频率限制是多少？**

* 每用户每分钟最多生成 5 张
* 超出限制会提示「请求过于频繁」
* 等待 1 分钟后重试

**Q3：可以自定义海报模板吗？**

* 目前提供 3 种模板
* 后续版本将支持自定义模板
* 可联系技术团队定制

### 5.2 支付配置相关

**Q1：支付二维码刷新周期是多久？**

* 二维码缓存 2 小时
* 过期后自动刷新
* 可手动刷新获取新二维码

**Q2：支付失败怎么办？**

* 检查微信商户号配置是否正确
* 检查回调地址是否可访问
* 查看系统日志获取错误信息

**Q3：支持其他支付方式吗？**

* 当前仅支持微信支付
* 后续版本将支持支付宝等
* 可联系技术团队定制

### 5.3 订单核销相关

**Q1：核销码的有效期是多久？**

* 核销码长期有效
* 建议在活动期间使用

**Q2：用户可以自己核销吗？**

* 不可以，必须由工作人员核销
* 保证核销的真实性和准确性

**Q3：核销后可以取消吗？**

* 可以，取消后订单恢复到「已支付」状态
* 建议记录取消原因

***

## 6. 故障排查

### 6.1 海报生成问题

| 症状 | 原因 | 解决方案 |
|------|------|---------|
| 生成失败，超时 | 后端服务异常 | 检查服务状态，重启服务 |
| 频率限制 | 请求过于频繁 | 等待 1 分钟后重试 |
| 模板加载失败 | 模板文件丢失 | 检查模板配置，联系技术支持 |

### 6.2 支付问题

| 症状 | 原因 | 解决方案 |
|------|------|---------|
| 二维码无法生成 | 商户号配置错误 | 检查商户号配置 |
| 支付失败 | 回调地址错误 | 检查回调地址配置 |
| 支付状态不同步 | 网络问题 | 手动同步订单状态 |

### 6.3 核销问题

| 症状 | 原因 | 解决方案 |
|------|------|---------|
| 扫码无响应 | 二维码损坏 | 刷新二维码 |
| 核销失败 | 签名验证失败 | 确认核销码正确 |
| 重复核销 | 已核销 | 提示用户已核销 |

***

## 附录

### A. 系统要求

* 浏览器：Chrome 90+, Safari 14+, Edge 90+
* 网络：稳定的互联网连接
* 设备：支持摄像头的智能手机（用于扫码核销）

### B. 技术支持

* 技术支持邮箱：support@example.com
* 工作时间：周一至周五 9:00-18:00
* 紧急联系人：+86-xxx-xxxx-xxxx

### C. 更新日志

| 版本 | 日期 | 更新内容 |
|------|------|---------|
| 1.0 | 2025-02-01 | 初始版本，包含海报生成、支付配置、订单核销功能 |

***

**文档版本**：1.0\
**最后更新**：2025-02-01\
**维护人员**：DMH 技术团队
