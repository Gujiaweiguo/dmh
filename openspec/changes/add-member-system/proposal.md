# Change: 引入会员系统（UnionID 平台唯一）以支持跨活动数据分析

## 状态: ✅ 已完成

## Why
目前“活动参加者”数据分散在各个活动/订单中，缺少一个跨活动可复用的主体（Member），导致：
- 无法稳定地跨活动识别同一人并沉淀画像
- 跨活动漏斗、复购/复参、渠道质量、分群、生命周期等分析需要重复拼接且口径不统一
- 品牌管理员只能看到活动内结果，缺少品牌维度的会员资产视角

## What Changes
- 新增 **会员系统（Member System）** 能力：以 `unionid` 作为平台唯一标识创建/维护会员档案
- 会员档案沉淀：基础资料、标签、来源渠道、参与历史、支付与奖励汇总
- 新增 **人工合并** 流程：平台管理员可将重复会员合并为一个主记录并迁移关联数据
- 新增 **导出审批** 流程：品牌管理员发起导出申请，平台管理员审批后生成导出
- 现有参与/订单/奖励数据在新增产生时与会员关联（不回填历史数据）

## Impact
- affected specs:
  - **新增**: `member-system`
  - **修改**: `campaign-management`, `mobile-landing-page`, `order-payment-system`, `reward-system`, `rbac-permission-system`, `sync-adapter`
- affected code (预估):
  - 后端：会员/导出审批相关数据模型与 API；参与/订单/奖励写入链路增加 member 关联
  - 前端（管理端/品牌端/H5）：会员列表/详情/合并/导出申请与审批 UI
- 数据与权限：
  - 会员平台唯一（`unionid` 唯一约束）
  - 平台管理员可查看全量会员；品牌管理员仅可查看本品牌关联会员
  - 导出需要审批（不做脱敏），数据永久保留

## Out of Scope
- 历史活动参加者/订单/奖励数据回填为会员（本变更不做）

## Risks
- `unionid` 获取依赖授权与渠道环境（非微信环境可能获取失败）
- 人工合并涉及关联数据迁移与一致性，需有审计与回滚策略
- 导出审批流程需要明确的可追溯性（审批记录、导出文件生命周期）

## Mitigation
- 明确“缺少 unionid 时的参与策略”（阻止参与/降级为匿名参与，需在 specs 中约束）
- 合并操作限定平台管理员，并记录审计日志；合并前进行冲突校验
- 导出审批：请求-审批-生成三段状态机 + 审计日志
