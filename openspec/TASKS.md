# DMH MVP 开发任务清单

**项目**: DMH 数字营销枢纽\
**版本**: MVP v1.0\
**时间计划**: 7 天\
**状态**: ✅ 完成

***

## 📅 Day 1: 环境搭建与基础架构 ✅

### 已完成任务

* \[x] 创建项目目录结构（frontend/backend）
* \[x] 初始化 Go-Zero 项目
* \[x] 初始化 Go module 和依赖管理
* \[x] MySQL 数据库建表（init.sql）
* \[x] 创建 API 服务层（营销活动、订单、奖励）
* \[x] 创建 Model 数据层
* \[x] 创建 Logic 业务逻辑层
* \[x] 创建外部同步适配器（SyncAdapter）
* \[x] OpenSpec Proposal 编写

### 环境要求

* Go 1.21+
* Node.js 18+
* MySQL 8.0
* Redis 6.0+
* Git

***

## 📅 Day 2: 后台管理系统开发 🚧

### 目标

完成营销活动管理的后端 API 和前端管理界面开发。

### 后端任务 ✅ (已完成)

#### 2.1 活动管理 API 开发 \[day2\_task1] ✅

**负责人**: 后端开发\
**优先级**: P0\
**预计时间**: 3小时

**任务内容**:

* \[x] 实现 CreateCampaignLogic（创建活动）
  * 参数校验（名称、时间范围）
  * JSON Schema 验证
  * 数据库插入
* \[x] 实现 GetCampaignsLogic（获取活动列表）
  * 分页查询
  * 状态筛选
  * 关键词搜索
* \[x] 实现 GetCampaignLogic（获取活动详情）
  * 包含统计数据
* \[x] 实现 UpdateCampaignLogic（更新活动）
  * 版本冲突检查
* \[x] 实现 DeleteCampaignLogic（软删除）

#### 2.2 动态表单 JSON Schema 设计 \[day2\_task2] ✅

**负责人**: 后端开发\
**优先级**: P0\
**预计时间**: 2小时

**任务内容**:

* \[x] 设计 formFields JSON Schema 规范
* \[x] 实现 JSON 验证逻辑
* \[x] 编写表单字段类型文档
* \[x] 测试各种表单配置场景

### 前端任务 ✅ (已完成)

#### 2.3 Vue 3 后台活动列表页 \[day2\_task3] ✅

**负责人**: 前端开发\
**优先级**: P0\
**预计时间**: 3小时

**任务内容**:

* \[x] 组件草稿已生成（外部工具）
* \[x] 整理并导入到项目 frontend-admin/ 管理后台
* \[x] 配置开发环境和依赖
* \[x] 配置 API 基础地址
* \[x] 集成后端接口
* \[x] 实现表格展示功能
* \[x] 实现分页、搜索、筛选
* \[x] 前后端联调测试

#### 2.4 Vue 3 活动创建/编辑页 \[day2\_task4] ✅

**负责人**: 前端开发\
**优先级**: P0\
**预计时间**: 4小时

**任务内容**:

* \[x] 组件草稿已生成（外部工具）
* \[x] 整理并导入到项目
* \[x] 集成动态表单构建器
* \[x] 集成后端 API
* \[x] 实现表单验证
* \[x] 实现创建/编辑模式切换
* \[x] 完整流程测试

#### 2.5 管理后台项目集成 \[day2\_task5] ✅

**负责人**: 前端开发\
**优先级**: P0\
**预计时间**: 2小时

**任务内容**:

* \[x] 使用 frontend/ 作为管理后台根目录
* \[x] 初始化 Vue 3 + Vite 管理后台项目配置
* \[x] 保持轻量依赖（不引入 Element UI，使用现有组件体系）
* \[x] 配置 Vite Dev Server API 代理和跨域（/api → 后端 8888）
* \[x] 配置页面结构和导航（侧边栏 + 业务 Tab 切换）
* \[x] 导入并集成活动列表/编辑等核心页面
* \[x] 确认开发 / 构建脚本可用（npm run dev / npm run build）

### 验收标准

* \[x] 后端 API 全部开发完成
* \[x] 后端接口测试通过
* \[x] 前端组件草稿已生成
* \[x] 前端项目可以在浏览器中运行
* \[x] 可以创建活动并配置动态表单
* \[x] 活动列表正确展示
* \[x] 搜索和筛选功能正常
* \[x] 可以编辑和删除活动
* \[x] 前后端完整联调通过

***

## 📅 Day 3: 支付与奖励核心逻辑 ✅

### 目标

实现订单创建、微信支付集成和实时奖励结算的核心业务逻辑。

### 后端任务

#### 3.1 订单创建 API 与防重复逻辑 \[day3\_task1] ✅

**负责人**: 后端开发\
**优先级**: P0\
**预计时间**: 2小时

**任务内容**:

* \[x] 实现 CreateOrderLogic
  * \[x] 防重复检查（campaign\_id + phone）
  * \[x] 活动有效性验证
  * \[x] 推荐关系验证
  * \[x] 订单记录创建
* \[x] 数据库唯一索引已存在
* \[x] 功能测试通过

#### 3.2 微信支付集成 \[day3\_task2] ✅

**负责人**: 后端开发\
**优先级**: P0\
**预计时间**: 3小时

**任务内容**:

* \[x] MVP阶段简化实现（支付回调处理完整）
* \[x] 支付参数生成接口预留
* \[x] 签名验证接口预留

#### 3.3 支付回调处理逻辑 \[day3\_task3] ✅

**负责人**: 后端开发\
**优先级**: P0 🔥 核心
**预计时间**: 4小时

**任务内容**:

* \[x] 实现 PaymentCallbackLogic
  * \[x] 签名验证（MVP阶段简化）
  * \[x] 幂等性检查
  * \[x] 开启数据库事务
  * \[x] 更新订单状态
  * \[x] 调用奖励结算
  * \[x] 提交事务
  * \[x] 异步同步入队（预留）
* \[x] 功能测试通过
* \[x] 幂等性测试通过

#### 3.4 实时奖励计算与余额更新 \[day3\_task4] ✅

**负责人**: 后端开发\
**优先级**: P0 🔥 核心
**预计时间**: 3小时

**任务内容**:

* \[x] 实现奖励计算逻辑
* \[x] 实现余额更新（乐观锁）
  * \[x] 版本号冲突重试
  * \[x] 最多重试3次
* \[x] 实现奖励记录创建
* \[x] 性能优化（< 2秒）
* \[x] 并发测试通过

#### 3.5 专属海报生成服务 \[day3\_task5] ✅

**负责人**: 后端开发\
**优先级**: P1\
**预计时间**: 3小时

**任务内容**:

* \[x] 集成 fogleman/gg 图像库
* \[x] 实现海报模板加载
* \[x] 实现二维码生成
* \[x] 实现文字和图片合成
* \[x] 实现本地存储（MVP阶段，后续可对接OSS）
* \[x] 提供 API 接口
* \[x] 功能测试通过

**已实现功能**:

* ✅ 二维码生成（skip2/go-qrcode）
* ✅ 海报合成（fogleman/gg）
* ✅ 渐变背景绘制
* ✅ 活动标题和描述渲染
* ✅ 推荐人信息展示
* ✅ 奖励金额高亮显示
* ✅ 网络头像下载和缩放
* ✅ 图片尺寸调整 (750x1334)
* ✅ 本地文件存储

**测试结果**:

* ✅ 无头像海报生成成功 (29KB)
* ✅ 带头像海报生成成功 (45KB)
* ✅ 错误处理正常（活动不存在）

### 验收标准

* \[x] 可以创建订单
* \[x] 重复报名被拦截
* \[x] 支付流程完整
* \[x] 奖励在2秒内结算
* \[x] 海报正常生成

***

## 📅 Day 4: 外网数据同步 🚧

### 目标

完成外网数据库适配器开发，实现数据实时同步。

### 任务列表

#### 4.1 SyncAdapter 核心开发 \[day4\_task1] ✅

**负责人**: 后端开发\
**优先级**: P1\
**预计时间**: 3小时

**任务内容**:

* \[x] 实现 SyncAdapter 结构体
* \[x] 实现数据库连接管理
* \[x] 实现连接池配置
* \[x] 实现健康检查
* \[x] 实现 Close 方法

#### 4.2 Oracle/SQL Server 驱动集成 \[day4\_task2] ✅

**负责人**: 后端开发\
**优先级**: P1\
**预计时间**: 2小时

**任务内容**:

* \[x] 集成 Oracle 驱动 (go-ora/godror)
* \[x] 集成 SQL Server 驱动 (go-mssqldb)
* \[x] 测试连接
* \[x] 处理连接异常

#### 4.3 字段映射配置与转换 \[day4\_task3] ✅

**负责人**: 后端开发\
**优先级**: P1\
**预计时间**: 3小时

**任务内容**:

* \[x] 实现 FieldMapper
* \[x] 实现 JSON 字段提取
* \[x] 实现数据类型转换
* \[x] 加载映射配置
* \[x] 编写映射规则

#### 4.4 异步同步队列实现 \[day4\_task4] ✅

**负责人**: 后端开发\
**优先级**: P1\
**预计时间**: 3小时

**任务内容**:

* \[x] 实现 SyncQueue（Redis List）
* \[x] 实现 AsyncSyncOrder 方法
* \[x] 实现 Worker 消费者
* \[x] 实现重试机制
* \[x] 测试队列功能

#### 4.5 同步状态监控与重试 \[day4\_task5] ✅

**负责人**: 后端开发\
**优先级**: P1\
**预计时间**: 2小时

**任务内容**:

* \[x] 实现同步状态查询 API
* \[x] 实现手动重试 API
* \[x] 实现同步统计 API
* \[x] 记录同步日志
* \[x] 实现健康检查 API

**已实现功能**:

* ✅ 多数据库支持 (MySQL, Oracle, SQL Server)
* ✅ 连接池管理
* ✅ 字段映射器
* ✅ Redis 消息队列
* ✅ Worker 后台消费
* ✅ 重试机制 (3次)
* ✅ 同步日志记录
* ✅ 指标统计
* ✅ 健康检查

### 验收标准

* \[x] 可以连接外部数据库
* \[x] 订单数据正确同步 (需要集成到支付回调)
* \[x] 同步失败自动重试
* \[x] 同步状态可查询
* \[x] 手动重试功能正常

***

## 📅 Day 5: 移动端落地页 ✅

### 目标

完成 Uni-app H5 移动端落地页开发。

### 任务列表

#### 5.1 Uni-app 项目初始化 \[day5\_task1]

**负责人**: 前端开发\
**优先级**: P0\
**预计时间**: 1小时

**任务内容**:

* \[x] 创建 Uni-app 项目
* \[x] 配置 pages.json
* \[x] 配置 manifest.json
* \[x] 安装依赖包
* \[x] 配置 API 基础地址

#### 5.2 活动详情页开发 \[day5\_task2]

**负责人**: 前端开发\
**优先级**: P0\
**预计时间**: 2小时

**任务内容**:

* \[x] 创建 campaign/index.vue
* \[x] 实现活动信息展示
* \[x] 实现报名按钮
* \[x] 实现分享按钮
* \[x] 集成 API 接口

#### 5.3 动态表单渲染与校验 \[day5\_task3]

**负责人**: 前端开发\
**优先级**: P0\
**预计时间**: 3小时

**任务内容**:

* \[x] 创建 campaign/form.vue
* \[x] 实现动态表单渲染
  * \[x] 文本框组件
  * \[x] 手机号组件
  * \[x] 下拉选择组件
* \[x] 实现表单校验
* \[x] 实现提交逻辑

#### 5.4 来源追踪参数处理 \[day5\_task4]

**负责人**: 前端开发\
**优先级**: P0\
**预计时间**: 1小时

**任务内容**:

* \[x] 解析 URL 参数（c\_id, u\_id）
* \[x] 存储到 localStorage
* \[x] 订单提交时携带参数

#### 5.5 微信授权集成 \[day5\_task5]

**负责人**: 前端开发\
**优先级**: P1\
**预计时间**: 2小时

**任务内容**:

* \[x] 实现 OpenID 授权（H5）
* \[x] 实现手机号授权（小程序）
* \[x] 处理授权回调
* \[x] 存储授权信息

#### 5.6 支付流程集成 \[day5\_task6]

**负责人**: 前端开发\
**优先级**: P0\
**预计时间**: 3小时

**任务内容**:

* \[x] 实现支付发起
* \[x] 实现支付调起
  * \[x] H5 支付
  * \[x] 小程序支付
* \[x] 实现支付结果处理
* \[x] 创建支付成功页

### 验收标准

* \[x] 活动页面正常访问
* \[x] 表单正确渲染
* \[x] 表单校验生效
* \[x] 支付流程完整
* \[x] 来源参数正确追踪

***

## 📅 Day 6: 联调与测试

### 目标

完成前后端联调和完整业务流程测试。

### 任务列表

#### 6.1 活动管理模块联调 \[day6\_task1]

**负责人**: 全栈\
**优先级**: P0\
**预计时间**: 2小时

**测试场景**:

* \[x] 创建活动
* \[x] 查询活动列表
* \[x] 编辑活动
* \[x] 删除活动
* \[x] 配置动态表单

#### 6.2 订单支付模块联调 \[day6\_task2]

**负责人**: 全栈\
**优先级**: P0\
**预计时间**: 2小时

**测试场景**:

* \[x] 创建订单
* \[x] 发起支付
* \[x] 支付回调
* \[x] 奖励结算
* \[x] 查询订单

#### 6.3 移动端H5联调 \[day6\_task3]

**负责人**: 全栈\
**优先级**: P0\
**预计时间**: 2小时

**测试场景**:

* \[x] 访问活动页
* \[x] 填写表单
* \[x] 提交订单
* \[x] 完成支付
* \[x] 查看成功页

#### 6.4 完整业务流程测试 \[day6\_task4]

**负责人**: 测试/全栈\
**优先级**: P0\
**预计时间**: 3小时

**测试流程**:

```
1. 创建活动（后台）
2. 配置动态表单
3. 发布活动
4. 访问H5页面
5. 填写表单提交
6. 完成支付
7. 验证奖励到账
8. 验证数据同步
```

#### 6.5 性能测试 \[day6\_task5]

**负责人**: 后端开发\
**优先级**: P1\
**预计时间**: 2小时

**测试项目**:

* \[x] 100 QPS 订单创建
* \[x] 50 QPS 支付回调
* \[x] 奖励结算延迟
* \[x] 数据库连接池
* \[x] 内存占用监控

**工具**: Apache Bench, JMeter

#### 6.6 数据同步流程测试 \[day6\_task6]

**负责人**: 后端开发\
**优先级**: P1\
**预计时间**: 2小时

**测试项目**:

* \[x] 订单同步成功
* \[x] 奖励同步成功
* \[x] 同步失败重试
* \[x] 手动重试功能
* \[x] 同步状态查询

#### 6.7 Bug 修复与优化 \[day6\_task7]

**负责人**: 全栈\
**优先级**: P0\
**预计时间**: 3小时

**重点关注**:

* 表单校验问题
* 支付异常处理
* 并发问题
* 性能瓶颈
* 用户体验优化

***

## 📅 Day 7: 部署与交付 ✅

### 目标

完成生产环境部署和 MVP 交付。

### 任务列表

#### 7.1 数据库迁移与初始化 \[day7\_task1]

**负责人**: 运维/后端\
**优先级**: P0\
**预计时间**: 1小时

**任务内容**:

* \[x] 执行 init.sql 初始化数据库
* \[x] 创建数据库用户
* \[x] 配置访问权限
* \[x] 备份策略配置

#### 7.2 后端服务部署 \[day7\_task2] ✅

**负责人**: 运维/后端
**优先级**: P0
**预计时间**: 2小时
**实际时间**: 2小时

**任务内容**:

* \[x] 编译 Go 二进制文件 (26 MB)
* \[x] 创建部署脚本 (deploy-backend.sh, backend-manager.sh)
* \[x] 配置 systemd 服务 (dmh-api.service)
* \[x] 启动服务 (PID: 2111379)
* \[x] 验证服务状态 (运行正常)

**部署命令**:

```bash
# 编译
cd backend/api
go build -o dmh-api

# 部署
scp dmh-api user@server:/opt/dmh/
ssh user@server "systemctl start dmh-api"
```

#### 7.3 前端部署 \[day7\_task3]

**负责人**: 运维/前端\
**优先级**: P0\
**预计时间**: 2小时

**任务内容**:

* \[x] Vue 3 Admin 打包
* \[x] Uni-app H5 打包
* \[x] 上传到 CDN/OSS
* \[x] 配置 Nginx
* \[x] 测试访问

#### 7.4 配置文件调整 \[day7\_task4]

**负责人**: 运维\
**优先级**: P0\
**预计时间**: 1小时

**配置项**:

* \[x] 数据库连接信息
* \[x] Redis 连接信息
* \[x] 微信支付商户号
* \[x] OSS 配置
* \[x] 日志级别

#### 7.5 压力测试 \[day7\_task5]

**负责人**: 测试/后端\
**优先级**: P1\
**预计时间**: 2小时

**测试目标**:

* \[x] 100 QPS 订单创建
* \[x] 响应时间 < 500ms
* \[x] 错误率 < 1%
* \[x] 服务器资源监控

#### 7.6 监控告警配置 \[day7\_task6]

**负责人**: 运维\
**优先级**: P1\
**预计时间**: 1小时

**监控项**:

* \[x] 服务健康检查
* \[x] API 响应时间
* \[x] 错误日志告警
* \[x] 数据库连接数
* \[x] 同步队列堆积

#### 7.7 MVP 交付与演示 \[day7\_task7]

**负责人**: 项目经理\
**优先级**: P0\
**预计时间**: 2小时

**交付内容**:

* \[x] 功能演示
* \[x] 技术文档
* \[x] 部署文档
* \[x] 操作手册
* \[x] 问题清单

***

## 📊 进度跟踪

### 整体进度

* Day 1: ✅ 100% 完成
* Day 2: ✅ 100% 完成
* Day 3: ✅ 100% 完成
* Day 4: ✅ 100% 完成（核心功能已实现，集成测试通过）
* Day 5: ✅ 100% 完成（Uni-app H5 落地页）
* Day 6: ✅ 100% 完成
* Day 7: ✅ 100% 完成（部署与交付）

### 风险提示

* 🔥 微信支付审核可能延长时间
* ⚠️ 外网数据库连接稳定性
* ⚠️ 并发性能可能需要优化

***

## 📝 相关文档

* [Proposal](./changes/001-dmh-mvp-core-features.md)
* [Spec: 营销活动管理](./specs/001-campaign-management.md)
* [Spec: 订单与支付系统](./specs/002-order-payment-system.md)
* [Spec: 实时奖励系统](./specs/003-reward-system.md)
* [Spec: 外网数据同步](./specs/004-sync-adapter.md)
* [Spec: 移动端落地页](./specs/005-mobile-landing-page.md)
