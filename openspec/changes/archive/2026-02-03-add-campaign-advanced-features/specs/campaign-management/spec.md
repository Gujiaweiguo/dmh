# 活动管理模块 - 增量变更

## ADDED Requirements

### Requirement: 海报生成功能
系统 SHALL 提供一键生成活动推广海报的功能，支持选择预设模板、自动生成包含活动信息和分销二维码的海报图片。

#### Scenario: 分销员生成推广海报
- **WHEN** 分销员在活动详情页点击"生成海报"按钮
- **AND** 选择一个海报模板
- **THEN** 系统应在 3 秒内生成包含活动信息和分销二维码的海报
- **AND** 返回海报图片 URL
- **AND** 支持下载和分享

#### Scenario: 海报包含分销二维码
- **WHEN** 分销员生成海报时提供了 distributorId
- **THEN** 生成的海报应包含该分销员的专属推广二维码
- **AND** 二维码扫描后应跳转到带有分销员标识的活动页面

#### Scenario: 海报生成频率限制
- **WHEN** 用户在 1 分钟内生成海报超过 5 次
- **THEN** 系统应返回频率限制错误
- **AND** 提示用户稍后再试

#### Scenario: 海报缓存机制
- **WHEN** 用户请求生成相同参数的海报
- **AND** 缓存中存在 24 小时内生成的海报
- **THEN** 系统应直接返回缓存的海报 URL
- **AND** 不重新生成

### Requirement: 支付配置功能
系统 SHALL 支持在活动级别配置支付参数，包括订金金额、全款金额，并自动生成微信支付二维码。

#### Scenario: 配置活动支付参数
- **WHEN** 品牌管理员创建或编辑活动
- **AND** 在支付配置区域设置订金金额为 99.00 元，全款金额为 299.00 元
- **THEN** 系统应保存支付配置到 campaigns.payment_config 字段
- **AND** 配置应包含支付类型、金额、商户号、回调地址

#### Scenario: 生成支付二维码
- **WHEN** 用户访问活动详情页
- **AND** 活动配置了支付参数
- **THEN** 系统应在 1 秒内生成微信支付二维码
- **AND** 二维码有效期为 2 小时
- **AND** 支持刷新二维码

#### Scenario: 支付二维码包含签名
- **WHEN** 系统生成支付二维码
- **THEN** 二维码内容应包含防伪签名
- **AND** 签名应基于订单信息和密钥生成
- **AND** 支付回调时应验证签名

#### Scenario: 支付二维码过期刷新
- **WHEN** 用户的支付二维码已过期
- **AND** 用户点击刷新按钮
- **THEN** 系统应生成新的支付二维码
- **AND** 更新有效期为 2 小时

### Requirement: 表单字段类型扩展
系统 SHALL 支持更多表单字段类型，包括邮箱、地址、多行文本，以满足不同业务场景的需求。

#### Scenario: 添加邮箱字段
- **WHEN** 品牌管理员在表单构建器中添加邮箱字段
- **AND** 设置字段为必填
- **THEN** 系统应保存字段配置
- **AND** 用户提交表单时应验证邮箱格式（正则：`/^[^\s@]+@[^\s@]+\.[^\s@]+$/`）

#### Scenario: 添加地址字段
- **WHEN** 品牌管理员在表单构建器中添加地址字段
- **AND** 设置最小长度为 5，最大长度为 200
- **THEN** 系统应保存字段配置
- **AND** 用户提交表单时应验证地址长度

#### Scenario: 添加多行文本字段
- **WHEN** 品牌管理员在表单构建器中添加多行文本字段
- **AND** 设置最大长度为 500
- **THEN** 系统应保存字段配置
- **AND** 前端应渲染为 textarea 组件

#### Scenario: 字段验证规则配置
- **WHEN** 品牌管理员为字段配置验证规则
- **AND** 设置正则表达式、最小/最大长度、错误提示
- **THEN** 系统应保存验证规则到字段配置
- **AND** 用户提交表单时应执行验证
- **AND** 验证失败时显示自定义错误提示

### Requirement: 表单字段排序功能
系统 SHALL 支持通过拖拽方式调整表单字段的显示顺序。

#### Scenario: 拖拽调整字段顺序
- **WHEN** 品牌管理员在表单构建器中拖拽字段
- **THEN** 系统应实时更新字段顺序
- **AND** 表单预览区应同步显示新顺序
- **AND** 保存活动时应保存字段顺序

#### Scenario: 字段顺序持久化
- **WHEN** 品牌管理员调整字段顺序后保存活动
- **AND** 重新打开活动编辑页
- **THEN** 字段应按保存的顺序显示

### Requirement: 表单实时预览
系统 SHALL 在活动编辑页提供表单实时预览功能，配置变更应立即反映在预览区。

#### Scenario: 添加字段实时预览
- **WHEN** 品牌管理员在表单构建器中添加新字段
- **THEN** 预览区应立即显示新字段
- **AND** 字段样式应与实际表单一致

#### Scenario: 修改字段属性实时预览
- **WHEN** 品牌管理员修改字段的标签、占位符或必填属性
- **THEN** 预览区应立即更新显示
- **AND** 必填字段应显示红色星号标记

## REMOVED Requirements

无删除的需求。

