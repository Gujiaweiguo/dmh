# DMH 全量回归证据模板

> 版本: Plan v1 (FRP-008)
> 变更: add-full-regression-testing
> 生成日期: 2026-02-18

---

## 1. 概述

### 1.1 目的

本文档定义 DMH 项目**全量回归**的标准证据模板，确保：

- 测试执行结果可追溯、可审计
- 回归结论与具体 workflow run 关联
- 失败明细支持快速定位与修复
- 证据保留符合审计周期要求

### 1.2 适用范围

| 场景 | 触发条件 | 使用本模板 |
|------|----------|------------|
| Release candidate 构建 | tag pattern: `v*.*.*-rc*` | ✅ 必须使用 |
| 主干受保护分支变更 | push to `main`/`master` | ✅ 必须使用 |
| 手动触发全量回归 | workflow_dispatch | ✅ 必须使用 |
| 普通 PR 验证 | pull_request | ❌ 使用 TEST_RESULT_TEMPLATE.md |

### 1.3 与现有模板的关系

| 模板 | 用途 | 关系 |
|------|------|------|
| `TEST_RESULT_TEMPLATE.md` | 单次测试执行记录 | 本模板是聚合层，引用各模块的 TEST_RESULT |
| `RISK_WAIVER_TEMPLATE.md` | 风险豁免申请 | FAIL 软阻断时使用 |
| 本模板 | 全量回归证据聚合 | 产出单一结论 + 审计追溯 |

### 1.4 引用规格

- **全量回归定义**: `docs/testing/execution/FULL_REGRESSION_DEFINITION.md` (FRP-002)
- **发布阻断规则**: `docs/testing/execution/RELEASE_BLOCKING_RULES.md` (FRP-003)
- **证据保留策略**: `docs/testing/execution/EVIDENCE_RETENTION_POLICY.md` (FRP-005)
- **CI 编排方案**: `docs/testing/execution/CI_ORCHESTRATION_PLAN.md` (FRP-006)

---

## 2. 完整证据模板

以下是全量回归证据报告的标准模板：

```markdown
# 全量回归证据报告

## 基本信息

| 字段 | 值 |
|------|-----|
| **报告ID** | `FR-[YYYYMMDD]-[序号]` 或 `[Run ID]` |
| **执行时间** | `[开始时间] - [结束时间]` (ISO 8601) |
| **触发事件** | `RC 构建` / `主干变更` / `手动触发` |
| **触发提交** | `[Git SHA]` |
| **触发分支** | `[分支名]` |
| **触发标签** | `[标签名，如适用]` |
| **执行人/触发者** | `[用户名]` 或 `automated` |

## 回归结论

| 项目 | 值 |
|------|-----|
| **最终结论** | `PASS` / `FAIL` / `INCONCLUSIVE` |
| **结论依据** | [引用具体判定规则，如 "所有必跑套件通过，覆盖率达标"] |
| **阻断级别** | `无阻断` / `硬阻断` / `软阻断` |

### 结论判定规则引用

- PASS: 所有必跑套件 100% 通过 + 覆盖率达标 + OpenSpec 无错误
- FAIL: 任一必跑套件失败 或 覆盖率不达标 或 OpenSpec 校验失败
- INCONCLUSIVE: 部分套件因环境问题未执行，需人工裁定

---

## 后端测试结果 (Backend)

| 套件 | 状态 | 通过/总数 | 覆盖率 | 阈值 | 日志链接 |
|------|------|-----------|--------|------|----------|
| 单元测试 | [✅/❌] | X/Y | Z% | 76% | [link] |
| 集成测试 | [✅/❌] | X/Y | - | - | [link] |
| 订单专项回归 | [✅/❌] | X/Y | - | - | [link] |

### 后端覆盖率详情

| 模块 | 覆盖率 | 阈值 | 状态 |
|------|--------|------|------|
| 整体 | Z% | 76% | [✅/❌] |

### 后端失败用例（如有）

| 用例ID | 用例名称 | 失败原因 | 所属套件 | 日志链接 |
|--------|----------|----------|----------|----------|
| - | - | - | - | - |

---

## 前端测试结果 (Frontend)

### 管理后台 (Admin)

| 套件 | 状态 | 通过/总数 | 覆盖率 | 阈值 | 日志链接 |
|------|------|-----------|--------|------|----------|
| 单元测试 | [✅/❌] | X/Y | Z% | 70% | [link] |
| E2E 测试 | [✅/❌] | X/Y | - | - | [link] |

### H5 前端

| 套件 | 状态 | 通过/总数 | 覆盖率 | 阈值 | 日志链接 |
|------|------|-----------|--------|------|----------|
| 单元测试 | [✅/❌] | X/Y | Z% | 44% | [link] |
| E2E 测试 | [✅/❌] | X/Y | - | - | [link] |

### 前端覆盖率汇总

| 模块 | 覆盖率 | 阈值 | 状态 |
|------|--------|------|------|
| Admin | Z% | 70% | [✅/❌] |
| H5 | Z% | 44% | [✅/❌] |

### 前端失败用例（如有）

| 用例ID | 用例名称 | 失败原因 | 所属模块 | 所属套件 | 日志链接 |
|--------|----------|----------|----------|----------|----------|
| - | - | - | - | - | - |

---

## OpenSpec 校验结果

| 校验项 | 状态 | 说明 |
|--------|------|------|
| 全量校验 | [✅/❌] | [详情] |
| Spec Delta 校验 | [✅/❌] | [详情] |

### OpenSpec 失败详情（如有）

| 校验类型 | 文件路径 | 错误信息 |
|----------|----------|----------|
| - | - | - |

---

## 失败明细汇总

### 硬阻断失败（如有）

| 序号 | 用例ID | 用例名称 | 失败原因 | 所属套件 | 严重程度 | 日志链接 |
|------|--------|----------|----------|----------|----------|----------|
| 1 | ... | ... | ... | ... | Blocker | [link] |

### 软阻断失败（如有）

| 序号 | 用例ID | 用例名称 | 失败原因 | 所属套件 | 严重程度 | 日志链接 |
|------|--------|----------|----------|----------|----------|----------|
| 1 | ... | ... | ... | ... | Critical | [link] |

---

## 重跑记录（如有）

| 重跑时间 | 重跑原因 | 重跑结果 | 操作人 |
|----------|----------|----------|--------|
| - | - | - | - |

---

## Flaky 测试隔离状态

| 测试ID | 测试名称 | 隔离状态 | 隔离原因 | 预期修复日期 |
|--------|----------|----------|----------|--------------|
| - | - | 无/隔离中 | - | - |

**说明**: 隔离清单内的测试不计入 FAIL 结论，但需记录隔离状态以便后续修复。

---

## 审计追溯

| 字段 | 值 |
|------|-----|
| **Workflow Run ID** | `[GitHub Actions Run ID]` |
| **Workflow URL** | `https://github.com/{owner}/{repo}/actions/runs/{run-id}` |
| **Artifacts 链接** | [下载链接] |
| **证据生成时间** | `[ISO 8601 时间戳]` |
| **保留截止日期** | `[日期: PASS 90天 / FAIL 180天]` |

### Artifacts 清单

| Artifact 名称 | 类型 | 大小 | 保留天数 |
|---------------|------|------|----------|
| `backend-test-{sha}` | 测试日志+覆盖率 | X MB | 90/180 |
| `admin-e2e-{sha}` | E2E 日志+截图 | X MB | 90/180 |
| `h5-e2e-{sha}` | E2E 日志+截图 | X MB | 90/180 |
| `regression-report-{run-id}` | 本报告 | X KB | 90/180 |

---

## 检索信息

本证据可通过以下方式检索：

```bash
# 按提交号检索
gh run list --commit {SHA}

# 按 Workflow Run ID 检索
gh run view {run-id}

# 按日期范围检索
gh run list --workflow full-regression.yml --created "YYYY-MM-DD..YYYY-MM-DD"

# 下载 Artifacts
gh run download {run-id} --dir ./evidence
```

---

## 签收信息（如适用）

| 角色 | 签收人 | 签收时间 | 备注 |
|------|--------|----------|------|
| - | - | - | - |

---

*报告生成时间: [ISO 8601 时间戳]*
*文档版本: FRP-008 v1*
```

---

## 3. 审计字段定义

### 3.1 基本信息字段

| 字段 | 类型 | 必填 | 格式/取值 | 说明 |
|------|------|------|-----------|------|
| **报告ID** | string | 是 | `FR-YYYYMMDD-NNN` 或 Run ID | 唯一标识，建议格式：FR-20260218-001 |
| **执行时间** | datetime range | 是 | ISO 8601 | 开始时间 - 结束时间，如 `2026-02-18T09:00:00Z - 2026-02-18T10:30:00Z` |
| **触发事件** | enum | 是 | `RC 构建`/`主干变更`/`手动触发` | 触发全量回归的事件类型 |
| **触发提交** | string | 是 | Git SHA (40位) | 触发回归的 Git commit |
| **触发分支** | string | 是 | 分支名 | 如 `main`、`master` |
| **触发标签** | string | 条件 | Git tag | RC 构建时必填，如 `v1.0.0-rc1` |
| **执行人/触发者** | string | 是 | 用户名或 `automated` | 手动触发为用户名，自动触发为 `automated` |

### 3.2 结论字段

| 字段 | 类型 | 必填 | 格式/取值 | 说明 |
|------|------|------|-----------|------|
| **最终结论** | enum | 是 | `PASS`/`FAIL`/`INCONCLUSIVE` | 单一回归结论 |
| **结论依据** | string | 是 | 引用判定规则 | 说明结论判定的依据 |
| **阻断级别** | enum | 是 | `无阻断`/`硬阻断`/`软阻断` | 映射到发布门禁动作 |

### 3.3 测试结果字段

| 字段 | 类型 | 必填 | 格式/取值 | 说明 |
|------|------|------|-----------|------|
| **状态** | enum | 是 | `✅`/`❌` | 测试套件通过/失败状态 |
| **通过/总数** | string | 是 | `X/Y` | 通过用例数/总用例数 |
| **覆盖率** | number | 条件 | 百分比 | 有覆盖率要求的套件必填 |
| **阈值** | number | 条件 | 百分比 | 覆盖率门禁阈值 |
| **日志链接** | URL | 是 | GitHub Actions URL | 指向详细日志的链接 |

### 3.4 失败明细字段

| 字段 | 类型 | 必填 | 格式/取值 | 说明 |
|------|------|------|-----------|------|
| **用例ID** | string | 是 | 测试用例唯一标识 | 如 `test-order-create-001` |
| **用例名称** | string | 是 | 测试函数名 | 如 `TestOrderCreate` |
| **失败原因** | string | 是 | 错误描述 | 断言失败、超时、运行时错误等 |
| **所属套件** | string | 是 | 套件名 | 如 `后端单元测试`、`Admin E2E` |
| **严重程度** | enum | 条件 | `Blocker`/`Critical`/`Major` | FAIL 时必填 |
| **日志链接** | URL | 是 | 日志片段链接 | 指向失败日志的具体位置 |

### 3.5 审计追溯字段

| 字段 | 类型 | 必填 | 格式/取值 | 说明 |
|------|------|------|-----------|------|
| **Workflow Run ID** | string | 是 | 数字 ID | GitHub Actions Run ID |
| **Workflow URL** | URL | 是 | GitHub Actions URL | 完整的 workflow 运行链接 |
| **Artifacts 链接** | URL | 是 | GitHub Artifacts URL | 证据下载链接 |
| **证据生成时间** | datetime | 是 | ISO 8601 | 报告生成的时间戳 |
| **保留截止日期** | date | 是 | YYYY-MM-DD | PASS: +90天 / FAIL: +180天 |

### 3.6 条件必填规则

| 条件 | 必填字段 |
|------|----------|
| 结论为 `FAIL` | 失败明细表（至少一条） |
| 结论为 `INCONCLUSIVE` | 重跑记录表（说明未完成原因） |
| 存在隔离中的 Flaky 测试 | Flaky 测试隔离状态表 |
| 触发事件为 `RC 构建` | 触发标签字段 |
| 软阻断 | 风险豁免申请链接 |

---

## 4. 分模块结果模板

### 4.1 Backend 模块模板

```markdown
## 后端测试结果 (Backend)

### 执行环境

| 项目 | 值 |
|------|-----|
| Go 版本 | 1.24.0 |
| 服务状态 | dmh-api:8889 ✅ |
| 数据库 | MySQL 8.0 ✅ |
| 缓存 | Redis 7 ✅ |

### 单元测试

| 项目 | 值 |
|------|-----|
| 状态 | [✅/❌] |
| 通过/总数 | X/Y |
| 覆盖率 | Z% (阈值: 76%) |
| 执行时长 | Xs |
| 命令 | `go test ./...` |
| 日志链接 | [link] |

**覆盖率详情**:
```
github.com/xxx/dmh/api/internal/logic/coverage: 78.5%
github.com/xxx/dmh/api/internal/middleware/coverage: 66.8%
github.com/xxx/dmh/api/internal/svc/coverage: 73.9%
total: (statements) Z%
```

### 集成测试

| 项目 | 值 |
|------|-----|
| 状态 | [✅/❌] |
| 通过/总数 | X/Y |
| 执行时长 | Xs |
| 命令 | `go test ./test/integration/... -v -count=1` |
| 日志链接 | [link] |

### 订单专项回归

| 项目 | 值 |
|------|-----|
| 状态 | [✅/❌] |
| 通过/总数 | X/Y |
| 执行时长 | Xs |
| 命令 | `backend/scripts/run_order_mysql8_regression.sh` |
| 日志链接 | [link] |

### 后端失败用例（如有）

| 用例ID | 用例名称 | 失败原因 | 所属套件 | 日志片段 |
|--------|----------|----------|----------|----------|
| `be-unit-001` | `TestOrderCreate` | 断言失败: expected 200, got 500 | 单元测试 | [link] |
| `be-integ-002` | `TestUserLoginFlow` | 超时: connection refused | 集成测试 | [link] |
```

### 4.2 Admin 模块模板

```markdown
## 管理后台测试结果 (Frontend-Admin)

### 执行环境

| 项目 | 值 |
|------|-----|
| Node.js 版本 | 22.x |
| 构建状态 | ✅ 成功 |
| 浏览器 | Chromium (Headless) |

### 单元测试

| 项目 | 值 |
|------|-----|
| 状态 | [✅/❌] |
| 通过/总数 | X/Y |
| 覆盖率 | Z% (阈值: 70%) |
| 执行时长 | Xs |
| 命令 | `npm run test` |
| 日志链接 | [link] |

**覆盖率详情**:
```
File                    | % Stmts | % Branch | % Funcs | % Lines |
------------------------|---------|----------|---------|---------|
All files               |   Z.Z   |   Z.Z    |   Z.Z   |   Z.Z   |
```

### E2E 测试

| 项目 | 值 |
|------|-----|
| 状态 | [✅/❌] |
| 通过/总数 | X/Y |
| 执行时长 | Xs |
| 命令 | `npm run test:e2e:headless` |
| 日志链接 | [link] |
| 截图链接 | [link] (如有失败) |

### Admin 失败用例（如有）

| 用例ID | 用例名称 | 失败原因 | 所属套件 | 截图 |
|--------|----------|----------|----------|------|
| `admin-e2e-001` | `Login flow` | 元素未找到: [data-testid="submit"] | E2E | [link] |
```

### 4.3 H5 模块模板

```markdown
## H5 前端测试结果 (Frontend-H5)

### 执行环境

| 项目 | 值 |
|------|-----|
| Node.js 版本 | 22.x |
| 构建状态 | ✅ 成功 |
| 浏览器 | Chromium (Headless) |

### 单元测试

| 项目 | 值 |
|------|-----|
| 状态 | [✅/❌] |
| 通过/总数 | X/Y |
| 覆盖率 | Z% (阈值: 44%) |
| 执行时长 | Xs |
| 命令 | `npm run test` |
| 日志链接 | [link] |

**覆盖率详情**:
```
File                    | % Stmts | % Branch | % Funcs | % Lines |
------------------------|---------|----------|---------|---------|
All files               |   Z.Z   |   Z.Z    |   Z.Z   |   Z.Z   |
```

### E2E 测试

| 项目 | 值 |
|------|-----|
| 状态 | [✅/❌] |
| 通过/总数 | X/Y |
| 执行时长 | Xs |
| 命令 | `npm run test:e2e:headless` |
| 日志链接 | [link] |
| 截图链接 | [link] (如有失败) |

### H5 失败用例（如有）

| 用例ID | 用例名称 | 失败原因 | 所属套件 | 截图 |
|--------|----------|----------|----------|------|
| `h5-e2e-001` | `Campaign detail` | 超时: 页面加载超过 30s | E2E | [link] |
```

### 4.4 OpenSpec 模块模板

```markdown
## OpenSpec 校验结果

### 执行环境

| 项目 | 值 |
|------|-----|
| OpenSpec CLI | latest |
| 校验范围 | 全量校验 |

### 全量校验

| 项目 | 值 |
|------|-----|
| 状态 | [✅/❌] |
| 命令 | `openspec validate --all --no-interactive` |
| 日志链接 | [link] |

### 校验详情

| 校验项 | 状态 | 详情 |
|--------|------|------|
| Spec 格式校验 | [✅/❌] | [详情] |
| Scenario 格式校验 | [✅/❌] | [详情] |
| 规格冲突检测 | [✅/❌] | [详情] |

### OpenSpec 失败详情（如有）

| 校验类型 | 文件路径 | 错误行号 | 错误信息 |
|----------|----------|----------|----------|
| 格式错误 | `openspec/specs/xxx/spec.md` | 42 | Scenario 标题格式不正确 |

### 校验输出示例

```
✅ openspec/specs/system-test-execution/spec.md - PASS
✅ openspec/specs/rbac-permissions/spec.md - PASS
❌ openspec/specs/xxx/spec.md - FAIL
   Line 42: Scenario format error, expected "#### Scenario:" but got "### Scenario:"
```
```

---

## 5. 填写示例

### 5.1 完整 PASS 示例

```markdown
# 全量回归证据报告

## 基本信息

| 字段 | 值 |
|------|-----|
| **报告ID** | FR-20260218-001 |
| **执行时间** | 2026-02-18T09:00:00Z - 2026-02-18T10:25:00Z |
| **触发事件** | RC 构建 |
| **触发提交** | abc123def456789012345678901234567890abcd |
| **触发分支** | main |
| **触发标签** | v1.2.0-rc1 |
| **执行人/触发者** | automated |

## 回归结论

| 项目 | 值 |
|------|-----|
| **最终结论** | PASS |
| **结论依据** | 所有必跑套件 100% 通过，覆盖率达标，OpenSpec 无错误 |
| **阻断级别** | 无阻断 |

---

## 后端测试结果 (Backend)

| 套件 | 状态 | 通过/总数 | 覆盖率 | 阈值 | 日志链接 |
|------|------|-----------|--------|------|----------|
| 单元测试 | ✅ | 156/156 | 78.2% | 76% | [link] |
| 集成测试 | ✅ | 27/27 | - | - | [link] |
| 订单专项回归 | ✅ | 12/12 | - | - | [link] |

## 前端测试结果 (Frontend)

### 管理后台 (Admin)

| 套件 | 状态 | 通过/总数 | 覆盖率 | 阈值 | 日志链接 |
|------|------|-----------|--------|------|----------|
| 单元测试 | ✅ | 121/121 | 72.5% | 70% | [link] |
| E2E 测试 | ✅ | 21/21 | - | - | [link] |

### H5 前端

| 套件 | 状态 | 通过/总数 | 覆盖率 | 阈值 | 日志链接 |
|------|------|-----------|--------|------|----------|
| 单元测试 | ✅ | 985/985 | 48.3% | 44% | [link] |
| E2E 测试 | ✅ | 7/7 | - | - | [link] |

## OpenSpec 校验结果

| 校验项 | 状态 | 说明 |
|--------|------|------|
| 全量校验 | ✅ | 所有规格文件校验通过 |

## 失败明细汇总

无失败用例。

## 重跑记录

无重跑记录。

## Flaky 测试隔离状态

无隔离中的 Flaky 测试。

## 审计追溯

| 字段 | 值 |
|------|-----|
| **Workflow Run ID** | 12345678901 |
| **Workflow URL** | https://github.com/owner/repo/actions/runs/12345678901 |
| **Artifacts 链接** | https://github.com/owner/repo/actions/runs/12345678901#artifacts |
| **证据生成时间** | 2026-02-18T10:25:00Z |
| **保留截止日期** | 2026-05-19 (PASS: 90天) |

---

*报告生成时间: 2026-02-18T10:25:00Z*
*文档版本: FRP-008 v1*
```

### 5.2 FAIL 示例（硬阻断）

```markdown
# 全量回归证据报告

## 基本信息

| 字段 | 值 |
|------|-----|
| **报告ID** | FR-20260218-002 |
| **执行时间** | 2026-02-18T11:00:00Z - 2026-02-18T12:15:00Z |
| **触发事件** | 主干变更 |
| **触发提交** | def456abc123789012345678901234567890abcd |
| **触发分支** | main |
| **触发标签** | - |
| **执行人/触发者** | automated |

## 回归结论

| 项目 | 值 |
|------|-----|
| **最终结论** | FAIL |
| **结论依据** | 后端单元测试失败 2 个用例，触发硬阻断 |
| **阻断级别** | 硬阻断 |

---

## 后端测试结果 (Backend)

| 套件 | 状态 | 通过/总数 | 覆盖率 | 阈值 | 日志链接 |
|------|------|-----------|--------|------|----------|
| 单元测试 | ❌ | 154/156 | 77.8% | 76% | [link] |
| 集成测试 | ✅ | 27/27 | - | - | [link] |
| 订单专项回归 | ✅ | 12/12 | - | - | [link] |

## 前端测试结果 (Frontend)

### 管理后台 (Admin)

| 套件 | 状态 | 通过/总数 | 覆盖率 | 阈值 | 日志链接 |
|------|------|-----------|--------|------|----------|
| 单元测试 | ✅ | 121/121 | 72.5% | 70% | [link] |
| E2E 测试 | ✅ | 21/21 | - | - | [link] |

### H5 前端

| 套件 | 状态 | 通过/总数 | 覆盖率 | 阈值 | 日志链接 |
|------|------|-----------|--------|------|----------|
| 单元测试 | ✅ | 985/985 | 48.3% | 44% | [link] |
| E2E 测试 | ✅ | 7/7 | - | - | [link] |

## OpenSpec 校验结果

| 校验项 | 状态 | 说明 |
|--------|------|------|
| 全量校验 | ✅ | 所有规格文件校验通过 |

## 失败明细汇总

### 硬阻断失败

| 序号 | 用例ID | 用例名称 | 失败原因 | 所属套件 | 严重程度 | 日志链接 |
|------|--------|----------|----------|----------|----------|----------|
| 1 | `be-unit-order-001` | `TestOrderCreate` | 断言失败: expected status 200, got 500 | 单元测试 | Blocker | [link] |
| 2 | `be-unit-order-002` | `TestOrderVerify` | 超时: database connection timeout | 单元测试 | Blocker | [link] |

**失败日志片段**:
```
=== RUN   TestOrderCreate
    order_test.go:45: expected status 200, got 500
    order_test.go:46: response body: {"code":500,"msg":"internal server error"}
--- FAIL: TestOrderCreate (0.15s)
```

## 重跑记录

| 重跑时间 | 重跑原因 | 重跑结果 | 操作人 |
|----------|----------|----------|--------|
| 2026-02-18T12:00:00Z | 环境瞬态问题重试 | FAILED | automated |

## Flaky 测试隔离状态

无隔离中的 Flaky 测试。

## 审计追溯

| 字段 | 值 |
|------|-----|
| **Workflow Run ID** | 12345678902 |
| **Workflow URL** | https://github.com/owner/repo/actions/runs/12345678902 |
| **Artifacts 链接** | https://github.com/owner/repo/actions/runs/12345678902#artifacts |
| **证据生成时间** | 2026-02-18T12:15:00Z |
| **保留截止日期** | 2026-08-17 (FAIL: 180天) |

## 处理建议

1. 检查 `backend/api/internal/logic/order/` 目录下最近的代码变更
2. 验证数据库连接配置是否正确
3. 修复失败用例后，重新触发全量回归

---

*报告生成时间: 2026-02-18T12:15:00Z*
*文档版本: FRP-008 v1*
```

### 5.3 INCONCLUSIVE 示例

```markdown
# 全量回归证据报告

## 基本信息

| 字段 | 值 |
|------|-----|
| **报告ID** | FR-20260218-003 |
| **执行时间** | 2026-02-18T14:00:00Z - 2026-02-18T14:30:00Z |
| **触发事件** | 手动触发 |
| **触发提交** | 789abc123def456789012345678901234567890a |
| **触发分支** | main |
| **触发标签** | - |
| **执行人/触发者** | developer@team |

## 回归结论

| 项目 | 值 |
|------|-----|
| **最终结论** | INCONCLUSIVE |
| **结论依据** | H5 E2E 测试因基础设施问题未执行完成，需人工裁定 |
| **阻断级别** | 硬阻断（需排查） |

---

## 后端测试结果 (Backend)

| 套件 | 状态 | 通过/总数 | 覆盖率 | 阈值 | 日志链接 |
|------|------|-----------|--------|------|----------|
| 单元测试 | ✅ | 156/156 | 78.2% | 76% | [link] |
| 集成测试 | ✅ | 27/27 | - | - | [link] |
| 订单专项回归 | ✅ | 12/12 | - | - | [link] |

## 前端测试结果 (Frontend)

### 管理后台 (Admin)

| 套件 | 状态 | 通过/总数 | 覆盖率 | 阈值 | 日志链接 |
|------|------|-----------|--------|------|----------|
| 单元测试 | ✅ | 121/121 | 72.5% | 70% | [link] |
| E2E 测试 | ✅ | 21/21 | - | - | [link] |

### H5 前端

| 套件 | 状态 | 通过/总数 | 覆盖率 | 阈值 | 日志链接 |
|------|------|-----------|--------|------|----------|
| 单元测试 | ✅ | 985/985 | 48.3% | 44% | [link] |
| E2E 测试 | ⚠️ | - | - | - | [link] |

**H5 E2E 未执行原因**:
- Chromium 启动失败: Failed to launch browser, executable not found
- 推测原因: Runner 环境问题

## OpenSpec 校验结果

| 校验项 | 状态 | 说明 |
|--------|------|------|
| 全量校验 | ✅ | 所有规格文件校验通过 |

## 失败明细汇总

无失败用例（INCONCLUSIVE 不计入失败）。

## 重跑记录

| 重跑时间 | 重跑原因 | 重跑结果 | 操作人 |
|----------|----------|----------|--------|
| 2026-02-18T14:15:00Z | H5 E2E 环境问题 | SKIPPED | automated |

## Flaky 测试隔离状态

无隔离中的 Flaky 测试。

## 审计追溯

| 字段 | 值 |
|------|-----|
| **Workflow Run ID** | 12345678903 |
| **Workflow URL** | https://github.com/owner/repo/actions/runs/12345678903 |
| **Artifacts 链接** | https://github.com/owner/repo/actions/runs/12345678903#artifacts |
| **证据生成时间** | 2026-02-18T14:30:00Z |
| **保留截止日期** | 2026-08-17 (INCONCLUSIVE: 180天) |

## 人工裁定需求

- [ ] 排查 H5 E2E 环境问题
- [ ] 重新触发全量回归验证 H5 E2E

---

*报告生成时间: 2026-02-18T14:30:00Z*
*文档版本: FRP-008 v1*
```

---

## 6. 存储与检索

### 6.1 存储位置

| 存储类型 | 位置 | 用途 | 保留策略 |
|----------|------|------|----------|
| GitHub Actions Artifacts | `actions/upload-artifact@v4` | CI 执行证据 | PASS: 90天 / FAIL: 180天 |
| GitHub Actions Logs | Workflow Run 页 | 实时日志 | GitHub 默认保留 |
| 报告归档 | `docs/testing/execution/runs/` | 本地归档副本 | 按需保留 |

### 6.2 Artifacts 命名约定

| Artifact 名称模式 | 示例 | 内容 |
|-------------------|------|------|
| `{module}-test-{sha}` | `backend-test-abc123` | 测试日志 + JUnit 报告 |
| `{module}-coverage-{sha}` | `admin-coverage-abc123` | 覆盖率报告 |
| `{module}-e2e-{sha}` | `h5-e2e-abc123` | E2E 日志 + 截图 + 录屏 |
| `regression-report-{run-id}` | `regression-report-12345678901` | 本证据报告 |
| `openspec-validation-{sha}` | `openspec-validation-abc123` | OpenSpec 校验输出 |

### 6.3 检索方式

```bash
# 1. 按提交号检索
gh run list --commit abc123def4567890

# 2. 按 Workflow Run ID 检索
gh run view 12345678901

# 3. 按日期范围检索
gh run list --workflow full-regression.yml --created "2026-02-01..2026-02-28"

# 4. 按结论过滤（通过 Run 状态）
gh run list --workflow full-regression.yml --status success
gh run list --workflow full-regression.yml --status failure

# 5. 下载 Artifacts
gh run download 12345678901 --dir ./evidence

# 6. 查看日志
gh run view 12345678901 --log
```

### 6.4 检索主键汇总

| 检索主键 | 格式 | 示例 |
|----------|------|------|
| 提交号 | `commit:[SHA]` | `commit:abc123def456` |
| Workflow Run ID | `workflow:[run-id]` | `workflow:12345678901` |
| 日期范围 | `date:[from]-[to]` | `date:2026-02-01-2026-02-28` |
| 回归结论 | `verdict:[PASS/FAIL]` | `verdict:FAIL` |
| 分支名 | `branch:[name]` | `branch:main` |
| 标签 | `tag:[name]` | `tag:v1.2.0-rc1` |

### 6.5 证据完整性检查清单

在归档证据前，确认以下内容完整：

- [ ] 基本信息：报告ID、执行时间、触发事件、提交信息
- [ ] 回归结论：最终结论、结论依据、阻断级别
- [ ] 后端结果：单元测试、集成测试、订单专项回归
- [ ] 前端结果：Admin 单元/E2E、H5 单元/E2E
- [ ] OpenSpec 结果：全量校验状态
- [ ] 失败明细：如有失败，填写详细用例信息
- [ ] 审计追溯：Workflow Run ID、Artifacts 链接、保留截止日期
- [ ] 日志链接：所有套件都有可访问的日志链接

---

## 7. 参考资料

- **全量回归口径定义**: `docs/testing/execution/FULL_REGRESSION_DEFINITION.md` (FRP-002)
- **发布阻断规则**: `docs/testing/execution/RELEASE_BLOCKING_RULES.md` (FRP-003)
- **Flaky 测试策略**: `docs/testing/execution/FLAKY_TEST_STRATEGY.md` (FRP-004)
- **证据保留策略**: `docs/testing/execution/EVIDENCE_RETENTION_POLICY.md` (FRP-005)
- **CI 编排方案**: `docs/testing/execution/CI_ORCHESTRATION_PLAN.md` (FRP-006)
- **测试结果模板**: `docs/testing/execution/TEST_RESULT_TEMPLATE.md`
- **风险豁免模板**: `docs/testing/execution/RISK_WAIVER_TEMPLATE.md`
- **Delta 规格**: `openspec/changes/add-full-regression-testing/specs/system-test-execution/spec.md`

---

## 8. 术语表

| 术语 | 定义 |
|------|------|
| **全量回归** | 覆盖必跑矩阵所有层级的发布前验证活动，产出单一结论 |
| **证据模板** | 标准化的测试结果记录格式，包含审计追溯字段 |
| **审计追溯** | 可追溯到具体 workflow run 的证据链 |
| **Workflow Run ID** | GitHub Actions 工作流运行的唯一标识符 |
| **Artifacts** | GitHub Actions 中存储的工作流产出物 |
| **报告ID** | 证据报告的唯一标识，格式为 `FR-YYYYMMDD-NNN` |
| **硬阻断** | 立即阻断发布，不允许人工豁免 |
| **软阻断** | 阻断发布，但可申请风险豁免 |
| **保留截止日期** | 证据过期删除的日期，PASS: 90天 / FAIL: 180天 |

---

*此文档由 FRP-008 任务生成，定义 DMH 项目的全量回归证据模板与审计追溯标准。*
